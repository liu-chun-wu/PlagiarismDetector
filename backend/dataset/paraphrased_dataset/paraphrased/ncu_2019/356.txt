為提升深度學習模型在實際交易回測的收益，本研究捨棄 Keras 內建損失函數，改用 TensorFlow 撰寫客製化損失函數，以更貼近實際交易需求。由於傳統 MSE 無法有效以股價方向為學習目標，且 Keras 內建函數調整參數功能有限，僅能基於 y_true 和 y_pred 計算，因此需要客製化。

此客製化損失函數基於 MSE 修改，在不改變原始設計的前提下，添加微調項目。其核心概念是根據預測方向與實際方向是否一致調整懲罰值，方向相同則減少懲罰，方向相反則增加懲罰，藉此引導模型學習正確方向。

計算步驟如下：
1. 使用 tf.manip.roll 複製並滾動實際值 (y_true) 和預測值 (y_pred) 的 Tensor，得到前一日股價 y_true_1 和 y_pred_1。
2. 將實際值和預測值分別與其前一日股價相減，計算一日價差（殘差）。
3. 計算實際方向 (trueD = y_true - y_true_1) 和預測方向 (predD = y_pred - y_pred_1)。
4. 判斷實際方向與預測方向是否一致：相乘 < 0 表示方向錯誤，相乘 > 0 表示方向正確。
5. 根據方向正確與否調整懲罰值：方向錯誤則增加，方向正確則減少。
