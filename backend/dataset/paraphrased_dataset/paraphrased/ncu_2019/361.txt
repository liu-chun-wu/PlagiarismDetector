經過前兩小節的實驗驗證，本研究進一步改良 LSTM 和 TCN 模型。參考 Granger (1999) 的研究，預測結果取決於損失函數和模型。前兩小節已完成模型比較和挑選，因此本研究著重於改進損失函數。

研究首先採用常用的 MSE 作為損失函數，之後以增加微調項目的方式設計客製化損失函數，避免過度修改而無法求得正解。客製化損失函數(圖 31) 複製並滾動實際值與預測值的 Tensor，計算兩天間價格的差距，再將實際值和預測值的價格差距相乘後取正負號，判斷預測方向是否與實際方向相同。方向相同則降低 0.01 單位的誤差值，方向錯誤則增加 0.01 單位的誤差值，以考量預測方向。

研究測試了 1、0.1、0.01 和 0.001 四種不同的懲罰值。0.001 因數值過小，學習結果與使用 MSE 幾乎相同；1 則干涉過大，導致無法正常學習，因此兩者皆被排除。0.1 雖能依據方向學習，但誤差值常無法收斂；0.01 影響較小，但能正常收斂，因此最終選擇 0.01 作為客製化損失函數的參數。

本研究結合客製化損失函數與 LSTM 和 TCN 模型，測試不同參數組合，找出參數與決定係數 (𝑅²) 和平均絕對縮放誤差 (MASE) 之間的關聯。LSTM 模型的三項商品比對結果(表 13、圖 32 至圖 34)顯示，雖然訓練集𝑅²都很高，但原油商品的測試集 𝑅² 和 MASE 明顯低於未使用客製化損失函數的結果；黃金和黃豆商品則差異不明顯。原油商品在使用客製化損失函數後準確度大幅下降，黃金和黃豆則些微上升。這顯示客製化損失函數可能對原本指標較低的商品(如原油) 無法帶來正向效果。

TCN 模型的測試結果(表 14 至表 17、圖 35 至圖 46) 顯示，黃金和黃豆在測試集的表現差異不大，原油則以 SeLu 啟動函數的結果較佳。Filters 方面，黃金無明顯差異，黃豆在 32、512 和 1024 較佳，原油在 128 至 512 的範圍較佳。Dilations 方面，黃金和原油無明顯突出值，黃豆在 8 至 128 的範圍表現較佳。Dropout_rate 方面，黃金和黃豆在 0 和 0.2 較佳，原油則在 0.5 較佳。

研究結果顯示，客製化損失函數對於原本學習成果較差的石油商品，學習情況反而下降。這是否會影響獲利情形，將於下一節探討。
