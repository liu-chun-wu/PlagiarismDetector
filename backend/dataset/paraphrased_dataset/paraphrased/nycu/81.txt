本章節沿用FFT影像進行瑕疵檢測，與3.2節不同之處在於，本方法無需二值化處理，直接使用原圖和視覺化後的影像進行檢測。視覺化後的方格影像會經過以下步驟：(1)製作Mask並繪製統計圖表 (2)計算peak之間的關係 (3)框出有線性瑕疵的方格。流程如圖3-13所示。

**3.3.1 製作Mask**

此小節利用FFT視覺化後的影像，使用mask統計影像上的白點。與3.2.2節相同，由於傅立葉轉換後的影像對稱，只需分析一半影像即可。首先將中心 𝑀× 𝑀 的像素點變為黑色，接著從影像左上角至中心點繪製一條寬度為1 pixel的直線，然後逆時針每隔4 pixels繪製一條直線，直到右下角，形成mask，用於計算影像上的白點。由於方格原圖上下左右不銜接，導致FFT後水平和垂直方向的高頻部分仍有能量，如圖3-14所示，上下左右皆不銜接，因此水平和垂直高頻部分存在能量。為方便觀察，將FFT影像進行負片處理，箭頭指向高頻能量區域。

本小節以直線從中心到邊緣的百分比作為變數，計算單條線從中心點到特定百分比的能量點總和。例如，百分比為20%，則僅計算中心點到線上20%處的能量點總和，如圖3-15所示。藉由調整百分比，觀察結果變化。

**3.3.2 計算Peak之間的關係**

與4.2.4節相同，除了最大peak位置、第二大peak位置以及兩者距離外，也考慮peaks之間的group關係。若第一大peak與第二大peak之間的波谷高度在規定百分比之上，則將兩者視為同一group，並比較第一大peak與第三大peak的距離。若距離大於5，則視為瑕疵，如圖3-16所示。圖中黃色虛線為大於最大peak 60%的臨界線，可見三個peak高於門檻值，且第一和第二大peak之間的波谷在門檻值之上，因此判斷第三大peak與第一大peak的距離。此距離大於10，故該方格被判斷為瑕疵。

**3.3.3 框出有線性瑕疵之方格**

與3.2.5節相同，將統計圖分為八個顏色區域。若最大值位於異常位置，則以最大值peak所在區間的顏色框出方格；若最大值位於正確位置，但第二或第三大peak與最大peak的距離大於門檻值，則左上角以最大值peak所在區間的顏色框出，右下角以第二或第三大peak所在區間的顏色框出。以圖3-17為例，第一大peak位於正確位置，故左上角以第一大peak位置的顏色（綠色）標記；第二大peak與第一大peak位於同一group，因此觀察第三大peak，其與第一大peak距離足夠大，位置在黃色區間，故右下角以黃色標記。

**3.4 不同方法之整理**

表3-1整理了不同方法在前處理和檢測階段所在的不同域，以便比較觀察。
