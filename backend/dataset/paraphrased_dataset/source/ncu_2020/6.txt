MP4 是由MPEG-4 標準所定義的多媒體容器格式，這種容器格式的完整名稱為 「MPEG-4 Part 14」，完整的定義在ISO/IEC 14496-14 標準中，通常用於儲存視訊及聲音 流媒體資料。而MPEG-4 Part 14 標準的基礎則建立在MPEG 4Part 12: ISO Base Media File Format（ISO/IEC/JTC 1/SC 29, 2005）標準之上。此標準制定的基礎主要基於 Apple 公司 的QuickTime 多媒體容器格式規格之上，但MP4 尚支持所謂的起始物件描述（IOD, Initial Object Descriptors）的特性。基於ISO 基本媒體檔案格式，MP4 檔案格式定義某些額外項， 用以支持MP4 視訊/聲音編解碼及不同的MPEG-4 系統特色，例如物件描述以及場景描 述等等。媒體資料內容為數張影像/聲音編碼出來的資料流，它可以和metadata 存放在同 一個檔案，也可以是存放在另一個檔案中。MP4 檔案把每個位元流資訊存放在各自獨立 的單軌裡，每個單軌記載著一連串的影像/聲音的時間資訊以及資料型態，每個單軌會有 自己的單軌識別符號，一個單軌內有許多樣本（Samples），以影像資料為例，一個樣本 代表一個VOP（Video Object Planes）。（Wikipedia(d), n.d.） Box（或稱為Atom）是MP4 檔案中最基本的資料單元，所有的視訊與控制資料都是 由Box 所包覆，每個Box 都包含大小與型態欄位資訊，Box 的型態是以一組四位元的 ASCII 碼來表示。Box 基本上還可以是一個階層式架構，換句話說一個Box 可以是一個 容器（Container Box），Box 內部還可以存放其他Box 資訊，也可以當作實際儲存資料的 欄位。在MP4 檔案中最上層的Box 分別是ftyp、mdat、moov 以及free 等四種，這些Box 都還可以個別再包覆其他類型的Box，其中串流影音資料會放置於mdat box 中，而所有 的Meta Data 會定義在moov Box 中。（Codingnote, 2020） 檔案型別元資料（ftyp atom）則是用來識別檔案型態，比較重要的欄位包括 「Major_Brand」、「Minor_Version」以及「Compatible_Brands」等三個欄位。影片樣本資 料（mdat Box）則用於存放視訊畫格及聲音樣本組等媒體資料。 Moov atom 大部分由一 個影片標頭元資料（mvhd box）和一個或多個單軌資料（trak box）所組合而成，影片標 頭內容包含此錄影檔的最初建立的日期時間、時間比例尺、總長度以及影片播放速率。 Trak box 用於定義影片，一部影片有可能是由一個或多個單軌所組成，每個單軌彼此獨 立並各自擁有的時間與使用空間資訊，單軌元資料（trak box）也有標頭紀載其相對應的 媒體資料。（Codingnote, 2020） 時間對樣本元資料（Time-to-Sample Box）：Box 欄位名稱為stts，其內部存著每筆樣 本的週期資訊。換句話說，Stts box 負責記錄每一個video frame 於畫面停留的時間長短 （delta time）。（Codingnote, 2020） 同步樣本元資料（Sync Sample Box）：Box 欄位名稱為stss，此Box 定義了媒體資料 中的主鍵畫面資料，以H.264 碼流來說即是I-Frame （intra coded picture, also called keyframe），在此主鍵畫面資料的定義為沒有經過動態預測或補償所編碼出來的影像，因 此失真度不會從上一張影像累積下來，同時主鍵畫面的解碼作業也可以不需要倚靠先前 其他畫面的參考，故可以提供一串影像重新同步化的功能。以一般監控攝影機來說都是 以I-Frame 起頭後接續一連串P-Frame（predictive coded picture）後再重新下一個I-Frame 的循環，示意圖如下圖 5 所示。每一組I-Frame 以及緊接相鄰的一連串P-Frame 稱為GOP （Group of Picture）。因為P-Frame 主要是利用紀錄與前一張畫面的殘差（residual）的方 式來減少自身的資訊量，示意圖如下圖 6所示，故每一連串P-Frame一定要有一個I-Frame 來做為最初的參考幀，一旦於傳輸中I-Frame 遺失或毀損，後續的P-Frame 將無法解碼還 原成原畫面，另外I-Frame 也提供使用者在跳躍播放時，快速將讀取位置移轉至最接近 的I-Frame 開始做解碼動作，而不需要從檔案中的第一張Frame 開始解碼以加速反應時 間。（IT 閱讀，2019） 圖 5 H.264 畫面編碼方式 資料來源：（Richardson, 2010） 圖 6 P-Frame 編碼示意 資料來源：（Richardson, 2010） 樣本對資訊塊元資料（Sample-to-Chunk Box）：Box 欄位名稱為stsc，內部儲存資訊塊 的資訊，讓使用者可以藉由得知各個樣本位於哪一個資訊塊中以及資訊塊中的哪個位置。 因為實務上影像與聲音資料是交互傳送然後被儲存到檔案中，連續的聲音或影像資料會 被稱作一個chunk，透過每一個chunk 中包含的sample 個數，我們即可以知道要找尋的 Frame 會落在哪一個chunk 中。（Codingnote, 2020） 樣本大小元資料（Sample Size Atom）：Atom 欄位名稱為stsz，其內容記載了各個樣 本的大小，如果只有一個樣本，或是所有樣本大小都相同，則此Box 的內容表格就只會 有一筆資料。（Codingnote, 2020） 資訊塊偏移值元資料（Chunk Offset Box）：Box 欄位名稱為stco，此Box 內容記錄了 從MP4 檔案開頭到每個資訊塊的偏移值（Offset），單位以位元組（Byte）為單位，可以 用32 位元或64 位元數字來表示。因為有了stsc box 與stsz box 的資訊再加上每一個chunk 在檔案中的偏移量，所以我們就可以間接計算出每一個sample 於檔案中的偏移位址。 （Codingnote, 2020）
