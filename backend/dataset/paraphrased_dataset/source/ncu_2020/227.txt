經過反編譯模組提取出apk 檔的Opcode、API 及Permission 後，特徵向量化模組將 使用不同的前處理方式將這三個特徵各自轉換成對應的特徵向量。 Opcode 特徵向量所代表的意義為一個Android 應用程式使用了哪些Opcode 以及各 個Opcode 被使用的順序。每個Opcode 都有其特殊的涵義，且都以十六進制表示法儲存 於dex 檔案中，例如「invoke-virtual」這個Opcode，作用為呼叫非private、static、final 及constructor 的方法，且十六進制表示法為「6E」。 從apk 檔中萃取出的Opcode 特徵為序列形式，即一連串的Opcode 呼叫，為了組成 特徵向量，首先將Opcode 序列中的每個Opcode 由十六進制的表示法轉換為十進制表 示法，使轉換後的Opcode 值介於0 至255 間，Opcode 特徵向量的長度則根據此apk 檔 萃取出的Opcode 序列長度決定，而Opcode 特徵向量中的每個索引都代表著Opcode 序 列中的每個Opcode，而對應的索引值則為Opcode 的十進制表示法。 如圖 12 所示，左半部為Opcode 特徵向量示意圖，右半部為常見Opcode 的名稱及 對應的十六進制表示法，在此圖中，Opcode 特徵向量中的第一個索引代表的是「sget- object」這個Opcode，而此索引對應到的值則為這個Opcode 從十六進制表示法轉換為 十進制表示法的值，即從十六進制的「62」轉換成十進制的「98」；第二個索引代表的是 結合多特徵及深度學習擴增技術提升Android 小樣本惡意家族分類能力 「invoke-virtual」這個Opcode，十六進制為「6E」，轉換成十進制為「110」；第三個索引 代表的是「move-result」這個Opcode， 十六進制為「0A」，轉換成十進制為「10」。Opcode 特徵向量可看出此Android 應用程式呼叫的Opcode 類型及呼叫順序關係。 圖 12  Opcode 特徵向量 （圖片來源：本研究） API 特徵向量代表的是Android 應用程式對特定API class 的依賴程度，顯示此應用 程式在執行時較可能做出的行為。API class 的名稱通常以API class 所提供的特定功能 來取名，且由一群Object 及Method 所組成，Method 的功能為針對物件進行操作及執行 相關的商業邏輯，本研究將Android 官方定義的API class 作為特徵，並觀察Android 應 用程式在每個官方定義的API class 中的Method 呼叫情況，判斷Android 應用程式對特 定哪幾個API class 有較高的依賴性。 本研究使用Androguard[73] 所提供的「load_permission_mappingsAPI」函數，提供 在特定的API level 下的API 和Permission 的對應關係（即每個API 各會使用到哪些 Permission），回傳的資料結構為Python 的Dictionary 型態，Dictionary 中的Key 欄位代 表某個API 的名稱，Value 則是List 資料結構，裡面的元素包含了這個API 在執行時所 結合多特徵及深度學習擴增技術提升Android 小樣本惡意家族分類能力 需要的Permission。根據此對應關係，建立API 特徵向量，特徵向量中的每個索引代表 每個Android API class，而索引中對應的值為呼叫到幾次屬於此API class 裡的Method。 如圖 13 所示，API 特徵向量的第一個索引代表「AbstractAccountAuthenticator」這 個API class ，負責處理帳戶驗證相關的邏輯操作，其中的Method 像是 「getAccountRemovalAllowed」，功能為檢查「移除帳號」這個動作是否被允許， 「confirmCredentials」則是檢查使用者有無通過憑證；第二個索引代表「AudioService」 這個API class，包含了幾乎所有音訊檔案相關的操作，像是音量控制、按下音量鍵彈出 音量大小調節提示框的過程、靜音功能以及音訊設備輸入及輸出的管理，其中的Method 像是「playMediaItem」，功能為將請求傳送到在背景運作的音訊任務，並指定播放其中 一項音訊檔案，「setSpeed」則是傳送請求到在背影運作的音訊任務，調整音訊檔案的播 放速度；第三個索引為「WifiP2pService」，負責處理與Wi-Fi 相關的任務；第四個索引 為「BluetoothA2dpBinder」，提供相關服務給需要使用藍芽服務的應用程式。其中在第三 個索引中的值為8，代表的意義是此Android 應用程式總共呼叫了8 次「WifiP2pService」 這個API class 中的Method。API 特徵向量能判斷Android 應用程式較依賴哪些特定的 API class，判斷可能產生的行為。 結合多特徵及深度學習擴增技術提升Android 小樣本惡意家族分類能力 圖 13  API 特徵向量 （圖片來源：本研究） Permission 特徵向量的生成同樣根據與API 特徵向量中的API 及Permission 對應關 係，Permission 特徵向量中的每個索引都代表著一個Permission，而索引中的值則是此 Android 應用程式使用了幾個需要使用到此Permission 的API method。 如圖 14 所示，第一個索引為「ACCOUNT_MANAGER」，此Permission 允許應用 程式呼叫「AccountAuthenticators」這個Class，此Class 處理有關帳號驗證的服務；第二 個索引代表的是「MODIFY_PHONE_STATE」，此Permission 允許應用程式修改手機的 狀態，例如開機及人機介面（Man Machine Interface，MMI）等等；第三個索引為 「MODIFY_AUDIO_SETTINGS」，允許應用程式修改全局音訊設定；第四個索引為 「REMOTE_AUDIO_PLAYBACK」。其中第二個索引的值為12，代表的是此應用程式使 用到了12 個需要「MODIFY_PHONE_STATE」的API method。Permission 特徵向量可 顯示Android 應用程式較常使用到哪些權限，依此來判斷較可能執行的行為。 結合多特徵及深度學習擴增技術提升Android 小樣本惡意家族分類能力 圖 14  Permission 特徵向量 （圖片來源：本研究）
