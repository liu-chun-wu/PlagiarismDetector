鑒於原架構的推論結果大多數為旋轉上的錯誤，這是因為偵測是對 空間位置敏感的任務，但一階段網路在迴歸預測框時只使用網格周圍 33 個特徵進行推論，而非該物件之精確位置特徵，這就是特徵沒對齊 (feature misalignment) 的問題；關鍵在於少了類似 Mask R-CNN [26] 論 文中的 RoI Align 特徵對齊操作，也就無法在候選框內均勻地分佈nn 個採樣點以提取特徵，其中n 可以為任意正整數。因此，我們在原架構 中加入對齊偵測模組 (align detection module, ADM) 來使本系統能對預 訂的錨框個別進行大小及位置的調整，該模組與 Faster R-CNN [13] 裡 的 RPN 的意義類似，都是希望先能夠先框出物件可能存在的位置，才 能在該框內進行特徵對齊；而該模組與 RPN 在訓練時的不同之處在於 RPN 為一個子網路，需要單獨訓練，但 ADM 是一個模組，可以將其 加進網路並跟整體網路一起訓練，因此在訓練時較為有效率。而 ADM 中的感興趣區塊卷積 (RoI convolution) 能做到跟 RoI Align 一樣功能， 就是能對所提出的框之內部特徵進行特徵對齊 (feature alignment)；但與 Faster R-CNN 不同的是，本系統在特徵對齊後的迴歸計算流程能以全卷 積的方式達成，因此速度上能保有一階段網路的優勢，且同時擁有二階 段網路的精準度。 感興趣區塊卷積為可變形卷積 (deformable convolution) 的一種特殊 形態，而可變形卷積的觀念是將卷積核內nn 個採樣點進行位移後，並 對各個位移後的採樣點以最接近採樣點的四個網格之特徵值進行雙線性 內插，來取得該採樣點的精確特徵值，並對精確的特徵值以卷積核提取特 徵，如圖 3.11 所示，不同的採樣點位移方法可以適用於各種不同形狀的 物件，像是放大、縮小、及旋轉之物件；而感興趣區塊卷積則是運用可變 型卷積能夠位移採樣點的特性，透過已知框的中心點位移及寬高資訊，將 可變形卷積的nn 個採樣點經過位移後，均勻地分佈在框內，此操作與 RoI Align 的意義相同，均為特徵對齊；但不同之處在於，感興趣區塊卷 積會在特徵對齊的同時以卷積核提取特徵。 - 35 - 圖 3.11. 可變形卷積的採樣點能進行不同方向與距離的位移 (a) 為一般 33 的卷積核，而 (b) 為33 可變形卷積核的採樣點以網路學 習的方式自行位移至感興趣之位置上提取特徵，(c) 的位移方 式為適用於大物件的特徵提取，(d) 則是適用於旋轉之物件。 本系統的第一次偵測之功用與 RPN 網路相似，但不同之處在於在 Faster R-CNN 中會以門檻值的方式來篩選 RPN 網路所提出的候選框， 並對每個候選框個別進行特徵對齊後得到精確的特徵值，再將得到的精 確特徵交由全連接層迴歸出結果。而 ADM 模組會對每個網格所負責的 錨框 (anchor) 進行調整，使學習到的錨框 (learned anchor) 能夠先框出 物件可能存在的位置，才能對框內特徵進行特徵對齊。並且藉由 ADM 模 組的全卷積特性，能夠使得在我們在推論速度上比起全連接的方法來的 更有效率。 本系統的具體流程是，我們先使每個網格的錨框能先調整至物件可 能存在的位置上，再將每個網格所負責的新錨框之位置資訊、大小資訊、 與骨幹特徵 (backbone feature) 一起交由感興趣區塊卷積，以感興趣區塊 卷積對每個網格所負責的新錨框之內部特徵進行特徵對齊與特徵提取。 由於經過感興趣區塊卷積所產生之特徵圖的不同網格可能含有不同物件 的資訊，為了避免使不同物件的訊息混淆在一起，我們在其後只兩層的 11 而非33 卷積提取特徵並迴歸出3D 預測框結果，如圖 3.12 所示。 - 36 - 圖 3.12. 本系統偵測的詳細流程之示意圖 (a) 和 (b) 屬於第一次偵測的 相關圖，(a) 是用以迴歸第一次偵測的特徵圖。在第一次推論 時 (a) 中的黑色網格周圍以格周圍33 個特徵，也就是灰色區 塊，進行推論，對應原圖即為 (b) 之灰色區塊，(b) 的紅色框 為真實數據之邊界框，綠色框為 (a) 中黑色網格所設置的錨 - 37 - 框；(c) 和 (d) 屬於第二次偵測的相關圖，(c) 為用來推論3D 預測框之特徵圖。(c) 中灰色區塊為第一次推論時黑色網格所 得到的新錨框，我們以感興趣區塊卷積在新錨框內均勻地分佈 77 個採樣點以提取特徵，所提取的特徵區塊對應回原圖即為 (d) 中的灰色區塊，(d) 的紅色框為為真實數據之邊界框，藍色 為第一次迴歸時所得到的新錨框，(e) 為透過感興趣區塊卷積 及兩次11 卷積所迴歸出的3D 預測框。
