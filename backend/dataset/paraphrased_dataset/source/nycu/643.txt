在實際情況下，人物會在進入商店前，通過閘門刷卡進入。刷卡時，透過產 學合作所架設的MQTT 會發送訊號，從訊號可以得知有人進來還是離開。當收 到人進來的訊息，便會開始追蹤此人。人物初始化的位置會在進入閘門的一瞬間。 如圖3-11。人物離開商店一樣需要通過閘門刷卡，完全離開閘門才會結束此人的 追蹤。 圖 3 -10 藍色點為各個樹莓派預估的人物位置 開始追蹤人物後，樹莓派會開始傳送偵測到的實際座標給PC。這時PC 會 將得到的實際座標進行分配，以當下距離某人ID 的前一刻位置最短的人獲得。 每個ID 所獲得到的每個點的權重一樣，也就是每個點相對於ID 位置的位移相 加平均後，再與前一刻的位置相加，便是此ID 的當前位置。對圖3-10 進行追蹤 所得到的結果。如圖3-12。 圖 3 - 11 追蹤初始化與追蹤結束 初始化位置 結束追蹤 進入 出口 圖 3 - 12 以圖3-11 進行追蹤 以圖3-12 的紫色人物為例，顯示周圍的樹莓派對他的偵測結果。如圖3-13。 圖3-10 與圖3-12 皆是在PC 中模擬實際情況的樣子，透過事先錄影。由於 樹莓派數量眾多，在錄影的時候並不會同步。所以樹莓派在錄影的同時，得另外 記錄每個frame 當下的時間。錄影結束後，便會產生一個時間戳。供日後模擬的 時候，可以依據時間戳，讓每支影片可以同步使用。 例如在frame = 132 時，開始追蹤某ID。如圖3-14；frame = 1750, 1751 時， 結束某ID 的追蹤。如圖3-15。由於是模擬的，所以在追蹤人的初始化與結束追 蹤的判定也會不一樣。 圖 3 - 13 以圖3-13 的紫色ID 進行偵測 圖 3 - 14 樹莓派回傳的座標(上)和開始追蹤(下) 圖 3 - 15 某ID 正要離開(上)和結束某ID 追蹤(下) 第四章 實驗結果 本篇論文電腦的實驗硬體設備為:Intel(R) Core(TM)i5-4440 CPU，作業系統為 64bits 的Windows7。使用的程式語言是Python，用OpenCV 3.4.0 輔助開發，環 境為Spyder；樹莓派的作業系統為Debian，程式語言是Python，OpenCV 3.4.0 做 預估的結果。 測試資料的來源皆於工研院的無人商店。樹莓派魚眼影像是640x480 大小， 擷取中間的320x320 大小，並縮小成160x160 大小，fps(frame per second)設為10， 測試影像中的人物會進出商店，場景內的人物會受限在5 人之內。在進行人物追 蹤前會以閘門的出入作為基準點。當人物通過閘門進入商店後，樹莓派會得到人 物的預估位置，傳送到電腦進行追蹤。人物離開閘門後，就會結束對離開的人的 追蹤。 目前工研院的無人商店還不算正式開啟，所以本篇論文所有的影像、影片皆 是我們自己錄製的，人物的各種行為皆是模擬消費者到商店所得到的資料。接下 來會分別以MOTA 跟IDF1 做為評估。
