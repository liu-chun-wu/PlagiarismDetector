系統建置流程請參考圖12 所示，詳細步驟說明如下。 圖 12 防禦系統建置流程圖 依據家用無線路由器的型號至DD-WRT 官方網站下載相應韌體如圖13， 並參考官方文件將無線路由器韌體刷新。 圖 13 DD-WRT Firmware download 預設DD-WRT 的有線網路會使用IP 192.168.0.1 並自動配發Client IP，首次登入， 會要求輸入自定義的帳號密碼（參考圖14），且沒設定則無法繼續使用，若管理者能避 免使用安全性低或是字典類型密碼，可有效降低被駭的風險。 圖 14 初次登入 進入設定->基礎設定->網路設定，依據表4.2 設定基礎有線網路，並將OpenDNS 的IP 設定至DHCP 上。 圖 15 有線網路設定 進入無線網路->基礎設定，無線部份2.4G 則啟用Net Isolation 將其隔離，隔出簡 易DMZ 區。 圖 16 受限的無線網路 進入伺服器->PPTP->PPTP 伺服器，啟用PPTP 伺服器並設定DHCP IP，依據使 用人數設定IP 及其帳號。 圖 17 PPTP VPN 設置 在系統管理部份可以依需求做防火牆的設定，在本實驗中為了避免使用者更改本 機中的DNS 試圖繞開DNS-Filter 的防禦，以及開放單方向的存取物聯網設備的需求便 有新增幾條指令。 依序進入系統管理->指令，於指令框內輸入以下指令 iptables -t nat -A PREROUTING -i br0 -p udp --dport 53 -j DNAT --to &(nvram get lan_ipaddr) iptables -t nat -A PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to &(nvram get lan_ipaddr) iptables -t nat -A PREROUTING -i ath0 -p udp --dport 53 -j DNAT --to &(nvram get lan_ipaddr) iptables -t nat -A PREROUTING -i ath0 -p tcp --dport 53 -j DNAT --to &(nvram get lan_ipaddr) 強制將DNS 服務導向設備，避免使用者規避防禦機制。 另外再新增下方指令，對受限的網路進行單方向存取。 iptables -I FORWARD -s 192.168.0.0/24 -j logaccept iptables -I FORWARD -s 10.0.100.0/24 -j logaccept 完成後點擊儲存防火牆指令即可。 圖 18 新增防火牆指令 以上便完成DD-WRT 的基本設定，接下來在OpenDNS 部份為了做更細部的控制 則需要在官方（https://www.opendns.com/）申請帳號並設定政策。OpenDNS 會偵測來 源端的IP，在固定IP 的狀況只需要將其新增至帳戶中即可，若是動態IP 則需另外安 裝程式定時向OpenDNS 更新IP 資訊，讓DNS Query 受到保護。 圖 19 OpenDNS 畫面 將家用IP 新增至帳戶後便可以設定細部的安全策略，以及開啟Botnet、Malware 以及釣魚網站的防禦功能。 圖 20 OpenDNS Security Setting
