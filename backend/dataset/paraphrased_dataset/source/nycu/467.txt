我們從資料集的影片中擷取影像串列當作標記的frame，但因影片數量眾多，室外 場景常常沒有人，為了擷取有人的frame，我們利用moving average 方法算出背景影像， 將下一個frame 跟背景影像做比較，若差異的區域面積大於影像寬度十分之一的平方， 則判斷有物體在移動。為了不要太多重複的人物，我們相隔3 秒或5 秒存一張圖，再將 圖片中的人物標注起來，包括整個人物遮罩(Mask)，並且標注其屬性，作為模型的訓練 資料。 在人工標記人物時，首先會先框出人物的bounding box。若人物是有被物體遮蔽的 情形，例如：貨架遮蔽、人物重疊等等，依然框出大概的全身bounding box 而不是只框 人物出現的部分，會設定這樣標記方法是因為我們希望接下來屬性辨識時，頭、身體、 腳所佔的比例可以大略一致，標注程式如下圖3-3 所示，其中我們所標注的bounding box 是可旋轉的且方向與半徑對齊。我們接著進行人物遮罩標注，若是完整的人，則標記完 整的人物，若是被物體遮蔽只露出部分身體，一律將有露出的部分再進行標記，若是人 物有被遮蔽超過一半以上，則會標記為don’t care。 這裡的人物遮罩標記利用超像素(Superpixel)來加速。Superpixel 是指具有相似紋理、 顏色、亮度等特征的相鄰像素構成的有一定視覺意義的不規則像素塊。它利用像素之間 的特性的相似性將像素分組，用少量的超像素代替大量的像素來表達圖片特徵，很大程 度上降低了圖像後處理的複雜度，標注超像素的範例如下圖3-4 所示。 標注完人物後接著要標記其屬性，如下圖3-5 所示。我們參考PA100K[10]及PETA[25] 的資料集項目，標記項目包含性別、年齡、騎乘、上衣顏色、上衣設計、長短袖、下身 顏色、下身設計、下身款式(裙、長褲、短褲)、帽子、大衣、時間(白天或晚上)、人物角 度以及攜帶物，在這邊多設了一個Unknown 選項，若是因光線或是遮蔽問題無法判別 的屬性，則會標記Unknown，在評估時就可先略過此屬性。 圖3-3 bounding box 標注程式示意圖 圖3-4 Mask 標注程式示意圖 圖3-5 屬性標注程式示意圖 3.2 人物偵測實驗 本章節會依序在下面各小節說明實驗的各種方法，並將相關實驗結果呈列在第 四章節，包含偵測行人bounding box 的Yolo v3 架構、魚眼影像的轉正、以及Yolo v3 模 型的finetuning。
