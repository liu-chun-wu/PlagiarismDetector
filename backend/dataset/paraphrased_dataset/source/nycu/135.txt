為進行第三方資料複製還原測試(Disk Array Based Replication)，多採用 磁碟陣列複製之方式，目前各大磁碟陣列廠商都有提供類似的功能，但其運 作原理可能稍有差異。本研究採用FreeNAS 版本11.2-U4.1 提供的相關功 能，提供的幾種做法，來加以實作驗證，因為前兩種方式的資源耗損過高， 或是穩定度不佳，所以採用了第三種方式，架構可參考下圖。 圖14  第三方磁碟陣列複製示意圖 資料來源：本研究整理 1. iSCSI + Rsync 遠端同步 原理是比對來源與目的檔案異動，並遠端上傳或下載拷貝檔案，對 於使用FreeNAS 直接當作檔案伺服器FileServer 來說，非常適用，無異 動的檔案無須重新傳輸，但並不適合此本研究，原因是本研究使用iSCSI 方式將Oracle Data 目錄結構儲存於單一檔案中，此檔案時刻變動，且大 小為40GB(一般企業資料量更大)，每一次Rsync 都需耗費相當多資源， 且實際測試後發現目的端主機有很高的機率出現I/O 故障的情況，導致 資料庫無法正常開啟。 2. iSCSI + Snapshot 檔案系統快照 + Replication 遠端複製 ZFS 檔案系統是Sun 昇陽公司於2001 年所開發，於2009 由Oracle 公司收購，於2013 年分支出OpenZFS 繼續維護(Zhang et al., 2010)。本 研究使用ZFS 檔案系統快照Snapshot 功能、遠端複製Replication 功能， 其優勢是快照比對是以Block-Level 做比對，大幅減少系統資源與快照時 間，並降低遠端複製時網路頻寬的需求，可達到異地備援要求等級，同 時快照與遠端複製是分開進行，不會互相影響衝突。 但本研究實際測試的結果，快照傳輸需求資源，除第一次全備份外， 其耗損資源遠小於使用Rsync 方式，傳輸效能更是遠勝於Rsync，但實 際測試多次後，也發現使用只要使用iSCSI，再次虛擬後的硬碟，最後都 會出現I/O 問題，或是檔案遺失損毀的狀況，所以本研究也不採用此方 式。 3. NFS 檔案系統掛載 + Vol Snapshot 磁區快照 + Replication 遠端複製 經過多次的測試，我們採用此方式，作為第三方磁碟陣列複製的測 試方法，因為Linux 作業系統中NFS Share，是非常成熟的檔案分享方 式。使用其特性，作為資料庫執行程式與資料庫檔案的掛載目錄，再經 由系統快照，遠端複製到目的主機，其耗損資源與網路傳輸量，幾乎同 等於上述第二項測試方式，所以我們選擇參考附錄五，用此方法來進行 驗證，此實驗需要4 台虛擬主機，包含2 台Linux 主機與2 台Disk Array NFS Share。 表6  第三方磁碟陣列複製測試主機與網路位置列表 Hostname IP ora1.jash.tw 192.168.1.201 ora2.jash.tw 192.168.1.202 freenas2.jash.tw(NFS Share to ora1) 192.168.1.230 freenas3.jash.tw(NFS Share to ora2) 192.168.1.231 資料來源：本研究整理 本研究加入快照本機複製Clone to Volume，為了避免每5 分鐘來自於 freenas2 的快照複製，造成目的端freenas3 資料損壞危險，並可快速與複寫 資料分離出來，成為獨立運作的檔案系統，相關操作及結果參考附錄十三。 關於第三方磁碟陣列複製，如實驗結果資料均正確無誤，但此方式還是 有一些缺點，例如：僅能5 分鐘複製到目的一次，需人工介入的流程稍複 雜，且有一定危險程度，需要技術性較高的管理者維護，但其最大的優點是， 價格遠低於Oracle 所提供的災難復原架構，最好能搭配第三方備份系統， 將資料盡量作多層次的分散備份，確保資料可用性。
