我們的系統中使用了三種損失函數，在影像本質分解包含了𝐸𝑑及 𝐸𝑐，光源分類的 部份則以𝐸𝑙表示。 𝐸𝑡𝑜𝑡𝑎𝑙= 𝐸𝑑+ 𝐸𝑐+ 𝐸𝑙 𝐸𝑑即是實體影像、光影影像、色溫參數以模型預測的結果與參考標準間的差距，我們 採用smooth L1(δ = 0.5)進行計算， 𝑠𝑚𝑜𝑜𝑡ℎ𝐿1(𝑥) = { 0.5𝑥2,                           𝑖𝑓 |𝑥| < 𝛿 𝛿∙(|𝑥| −0.5𝛿), 𝑜𝑡ℎ𝑒𝑟𝑤𝑖𝑠𝑒 smooth L1 相較於平方誤差函數更能降低離群點(outlier)的影響，讓訓練過程更為穩 定。由於在影像本質分解的階段會產生實體影像、光影影像、光的色溫參數、光的色 溫值的輸出，我們以標準差來平衡不同輸出之間的權重，資料中變異性最大的是光的 色溫值，我們以此為基底，將色溫值與其他輸出之間相距的倍數作為權重。而𝐸𝑐則是 基於本質影像分解的假設而加入的損失函數， 𝐸𝑐= |𝑅∙𝑆𝑅𝐺𝐵−𝐼| 𝑆𝑖= 𝑆𝐿∙𝑚𝑖+ 𝑐𝑖         , for 𝑖= 𝑅, 𝐺, 𝐵 我們將虛幻引擎4 中產生的光影影像𝑆𝑅𝐺𝐵分解成灰階圖𝑆𝐿及色溫參數，在三通道上的 色溫參數與灰階圖相乘後即可得到原光影影像的RGB 影像，𝑚𝑖及𝑐𝑖即為色溫參數，在 第六章節會再進行詳細的說明。在光源分類的部份為多標籤分類，每個區域都是二選 一，因此直接採用binary cross entropy 作為分類的損失函數，當預測結果與參考標準相 近時誤差接近於0。下列公式中，𝑌代表參考標準，𝑃代表預測結果。 𝐸𝑙= −∑𝑌𝑖 𝑖=1~10 ∙𝑙𝑜𝑔( 𝑃𝑖)
