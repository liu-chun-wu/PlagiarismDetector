此部分使用Python 讀取於前述處理的基本面因子排序結果，以及不同技術面策略 下的交易紀錄，搭配其他投資組合變數進行選股。Python 選股方式說明如下圖 25，首 先讀取符合該投組之技術面交易紀錄，再由基本面因子排序結果確認該檔股票是否為 可購買的股票（前一年因子排名符合該投組變數設定），接著檢查目前持有股數是否小 於最大持有股數、以及目前資金餘額是否還能夠買進，若條件皆符合則依照資金配置 法投入資金並扣除1 %手續費，同時從資金餘額中減去支出，該筆交易的賣出價格減 去買進價格後乘以購買張數之金額，為該筆交易獲利，另外，在進行每年年初開始選 股之前，皆會確認先前買入的股票是否已應當賣出，若已賣出且「資金再投入法」變 數值為1，會將獲利金額計入資金餘額中，反之若為0 則以當前餘額繼續進行交易，最 後將該投資組合交易紀錄及獲利匯出成檔名與投組各變數代號相對應之csv 檔案，檔 案內容如圖 26，供後續分析績效使用。 圖 25、Python 選股方式 圖 26、投資組合績效回測結果 投資組合績效分析模組 將每個投資組合輸出的回測結果做績效分析，包含迴歸分析、關鍵績效指標分 析、獲利來源分析及其他敘述性統計分析。敘述性統計分析目的為計算獲利指標與風 險指標，本研究包含以下幾項指標： 1. 投組淨利（Net Profit）：投資組合總獲利扣除初始資金，越高越好 2. 複合年平均投資報酬率（Compound Annual Growth Rate, CAGR）：以回測期間 19 年計算之年化報酬率，越高越好。 3. 最大價值虧損（Max Drawdown, MDD）：投組價值最大虧損，越低越好。 4. 獲利因子（Profit Factor）：投組中毛利總和除以毛損總和，越高越好 5. 獲利標準差（Standard Error）：表示權益的波動性，越低越好 6. 夏普比率（Sharp ratio）：平均報酬率減無風險報酬率再除以標準差，代表每承 擔一單位風險可獲得多少報酬，越高越好。 迴歸分析為「等分法下可分析多投組」類別下的一個分析方法，首先設定要分析 的技術面交易策略、參數設定、資金配置法、資金再投入方法及基本面因子，在此條 件下會篩選出五十個投資組合，因子排名分別為1 至10、各有五種不同最大持有股 數，接著針對每個最大持有股數下的投資組合，以因子排名為x 軸，年化報酬率 （CAGR）作為y 軸計算迴歸係數，得知每個因子與其等分排名之相關性，迴歸係數越 高表示越具有依賴性，且呈現負相關的因子代表排名越高獲利也越高，可視為表現較 好的模型，藉由此分析能夠知道哪項基本面因子適合當作投資參考。 關鍵績效指標分析則是「等分法下可分析單一投組」類別下的方法，為本研究另 創之比較標準，為了能夠在各種不同條件下，了解單一投組在所有投組間之表現排 名，使用最小值最大值正規化（Min-Max Normalization）方法，將CAGR、MDD 及 Sharpe Ratio 做數值正規化，使各項指標尺度統一，為方便後續視覺化呈現，將分數以 1~10 呈現。 最後獲利來源分析是統計單一投組中每檔股票的交易次數及獲利金額，用以了解 投組中獲利與虧損的股票分布，可知道投資組合穩定性。 分析完成之結果會存入資料庫中，使視覺化呈現時可獨立運作。 視覺化呈現模組 最後為了讓投資人對所有分析結果一目瞭然，本系統將分析結果在Jupyter Notebook 平台上以視覺化呈現，並將所有視覺化方法包裝成模組，使用者可依照參數 說明執行視覺化模組下的函數方法（Python def），方便使用。 迴歸分析比較圖操作方法與呈現結果示意如下圖 27，最上方為使用Markdown 語 法寫的說明文件，中間為呼叫函數程式碼，以買入持有無參數為例，呼叫函數時傳入 的參數為指定技術面指標及資金相關用法，最下方為產生的圖表，此函數會列出在不 同持有股數下，各因子的年化報酬率及其迴歸線，而為清楚呈現，在圖上只顯示迴歸 係數前五名的因子。 圖 27、Jupyter Notebook 上視覺化呈現回歸分析部分截圖 關鍵績效指標分析圖能夠在指定基本面因子、排名及最大持有股數下，比較使用 不同技術面策略搭配不同資金用法的表現績效，使用時須指定基本面因子、排名及最 大持有股數代號，會呈現14 種不同投資方法下的獲利與風險，評估指標分別為年化報 酬率、最大虧損以及夏普比率，呼叫方式及呈現結果如圖 28，同樣有說明文件、程式 碼與圖表三格部分，圖 28 以因子1「折舊除以投入資本」、排名10、最大持有10 股為 例。 圖 28、Jupyter Notebook 上視覺化呈現KPI 分析部分截圖 最後一項為獲利來源分析圖，以圓餅圖呈現分析結果，圓餅圖有兩個部分：外圈 及內圈，外圈代表該投資組合獲利的分布，相反內圈則代表虧損的分布，呼叫此方法 時必須指定投資組合之七項變數，為清楚呈現，圓餅圖上僅標示獲利值前五高與虧損 值前五高之股票，其餘以「Others」表示，Jupyter Notebook 上也有說明文件、程式碼 與圖表三格部分，圖 29 為買入持有、無參數、平均投入下，因子1「折舊除以投入資 本」、排名1、最大持有180 股之獲利來源圖。 圖 29、Jupyter Notebook 上視覺化呈現獲利來源分析
