經由前兩小節之實驗驗證後，本研究將針對LSTM 及TCN 做出進一步的改良，根據文 獻中所提及，預測的結果會取決於損失函數和模型本身(Granger, 1999)，因此本研究已經在前 兩小節進行模型的比較與挑選，接著能夠提升結果的方式便是改進損失函數的部分。在本研 究當中，我們預先採用了大家最常採用的MSE 做為損失函數，再進行客製化損失函數時本研 究為了過度修改損失函數導致無法求得正解，因此採用增加微調項目的方式來讓學習往正確 的方向收斂，本研究所設計之客製化損失函數如圖 31，透過將實際值與預測值的Tensor 進 行複製並滾動一天，以求得兩天間價格的差距，再透過實際值與預測值兩者的價格差距相乘 後取正負號，來判斷預測方向是否與實際方向相同，當方向相同時會降低0.01 個單位的誤差 值，方向錯誤時給予逞罰增加0.01 個單位的誤差，以此達到考量方向的損失函數學習方式。 圖 31 客製化損失函數 在逞罰值的選擇上，本研究也針對不同的數值進行測試，在參數上選擇了1、0.1、0.01 及 0.001 四種數值最為比較，其中0.001 因為數值較小，較難以有效干涉到學習過程，因此學習 後的結果皆與直接使用MSE 相差無幾，因次被本研究排除，而1 的部分則是干涉太大，導致 無法正常學習，也被本研究排除，最後本研究針對0.1 及0.01 進行了嘗試，最終選擇0.01 的 原因在於若是選擇0.1 雖然能依據方向去學習，但是實際學習中的誤差值時常無法收斂，而 0.01 雖然引響較0.1 小但是能夠正常收斂，因此本研究在最後選擇0.01 作為本研究之客製化 損失函數之參數選擇。 本研究將客製化損失函數結合LSTM 及TCN 模型，透過各項參數組合之測試，找出參 數與決定係數(𝑅2)與平均絕對縮放誤差(MASE)之間的關聯。首先，本研究針對LSTM 模型進 行三樣商品的比對，其結果如下表 13 及圖 32 至圖 34，雖然在訓練集下都是保持著很高𝑅2， 但是從原油商品來看，測試集的𝑅2與MASE 的結果明顯較尚未使用客製化損失函數來得低， 黃金及黃豆商品的差異並不明顯，從表 13 及圖 34 可以見得，原油商品在經過客製化損失函 數調整後之準確度明顯大幅下降，黃金則黃豆反而些微上升，這也讓本研究考量是否對於原 油這種在使用客製化損失函數前指標就相對較低的商品，反而無法帶來正向的效果。 表 13 客製化損失函數LSTM 模型之運算結果 隱藏層 神經元 黃金 train 0.992 0.994 0.994 0.994 0.993 0.989 0.993 0.993 0.992 0.993 test 0.956 0.966 0.967 0.965 0.96 0.937 0.959 0.962 0.963 0.965 MASE 0.886 0.75 0.741 0.761 0.838 1.06 0.846 0.803 0.806 0.774 黃豆 train 0.974 0.966 0.966 0.98 0.98 0.977 0.979 0.976 0.981 0.981 test 0.926 0.896 0.847 0.951 0.954 0.918 0.935 0.911 0.945 0.949 MASE 0.629 0.778 0.943 0.466 0.44 0.639 0.562 0.671 0.506 0.482 原油 train 0.975 0.984 0.966 0.958 0.962 0.978 0.982 0.99 0.99 0.99 test 0.347 0.659 0.203 -0.053 0.017 0.442 0.568 0.835 0.865 0.862 MASE 5.109 3.498 6.333 7.227 6.905 4.455 3.811 2.039 2.11 2.238 圖 32 客製化損失函數LSTM 模型在黃金之選擇 圖 33 客製化損失函數LSTM 模型在黃豆之選擇 圖 34 客製化損失函數LSTM 模型在原油之選擇 在TCN 的部分，本研究同樣根據啟動函數、Filters、Dilations 以及Dropout_rate 四個面 向個別測試，TCN 模型之計算結果如下表 14 至表 17。 啟動函數部分（參見表 14），在訓練集的部分都呈現了很高的𝑅2，而在測試集部分在黃 金和黃豆差異不明顯，甚至黃豆的ReLu 較好，原油商品上是SeLu 較ReLu 優異，MASE 亦 同，並且可以從圖 35 至圖 37 見得，僅有原油商品的SeLu 與ReLu 差距較明顯，位於圖形 右下角，黃金及黃豆因單位很小，本研究認定其無明顯差異。此處的其他參數分別為Filters:256、 Dilations:[32]及Dropour_rate:0.2。 Filters 的部分（參見表 15），在測試集部分在黃金商品無特別突出，黃豆則是在32、512 及1024 較高，但差異也不大，原油則是在參數128 至512 的區域較優異，MASE 亦同，並且 可以從圖 38 至圖 40 見得黃金因單位很小，本研究認定其無明顯差異，黃豆商品則是32、 512 及1024 的點較其他參數明顯位於右下角處，原油商品在參數128 至512 範圍的點，位於 圖形右下角，但是也可以觀察到這時候的MASE 指標呈現的結果其實是相對於比較差的結果。 此處的其他參數分別為啟動函數：SeLu、Dilations:[32]及Dropour_rate:0.2。 Dilations 部分（參見表 16），在測試集部分黃金和原油並無特別突出，黃豆則是8 至128 都有差不多的表現，MASE 亦同，並且可以從圖 41 至圖 43 見得，黃金在參數512 的點較其 他點差，偏向左上角，黃豆則是在8 至128 的範圍十分集中，座落於右下角，然而原油商品 的MASE 其實都很高，屬於不佳的結果。此處的其他參數分別為啟動函數：SeLu、Filters:256、 及Dropour_rate:0.2。 Dropout_rate 部分（參見表 17），在測試集部分黃金及黃豆在0 及0.2 較優，原油在參數 0.5 較優，MASE 亦同，並且可以從圖 44 至圖 46 見得，黃金在0 及0.2 的點都落於圖形右 下角，黃豆在0 與0.2 表現較佳，且與其餘兩點有明顯之差異，原油僅有0.5 一點的MASE 屬 於較佳結果，且位於圖形之右下角。此處的其他參數分別為啟動函數：SeLu、Filters:256、及 Dilations:[32]。 根據上述結果，可以發現，經由客製化損失函數調整過的模型，對於石油的學習情況有 些下降，原因可能來自於石油商品原本的學習成果在傳統指標上就相較於另外兩種商品低， 但這樣的結果是否會直接影響到獲利情形，本研究將在下一節繼續探討。 表 14 客製化損失函數TCN 模型之運算結果（啟動函數） 啟動函數 SeLu ReLu 黃金 train 0.979 0.983 test 0.96 0.956 MASE 0.833 0.892 黃豆 train 0.953 0.971 test 0.907 0.929 MASE 0.711 0.597 原油 train 0.988 0.979 test 0.936 0.663 MASE 1.592 3.192 圖 35 客製化損失函數TCN 的啟動函數在黃金之選擇 圖 36 客製化損失函數TCN 的啟動函數在黃豆之選擇 圖 37 客製化損失函數TCN 的啟動函數在原油之選擇 表 15 客製化損失函數TCN 模型之運算結果（Filters） Filters 黃金 train 0.988 0.982 0.981 0.979 0.961 0.932 test 0.961 0.939 0.964 0.96 0.949 0.952 MASE 0.81 1.077 0.766 0.833 0.961 0.924 黃豆 train 0.981 0.909 0.93 0.953 0.962 0.951 test 0.952 0.898 0.884 0.907 0.937 0.93 MASE 0.468 0.756 0.829 0.711 0.552 0.597 原油 train 0.966 0.95 0.987 0.988 0.991 0.983 test 0.402 0.321 0.825 0.936 0.922 0.759 MASE 4.757 5.151 2.447 1.592 1.811 3.381 圖 38 客製化損失函數TCN 的Filters 在黃金之選擇 圖 39 客製化損失函數TCN 的Filters 在黃豆之選擇 圖 40 客製化損失函數TCN 的Filters 在原油之選擇 表 16 客製化損失函數TCN 模型之運算結果（Dilations） Dilations 黃金 train 0.985 0.981 0.979 0.97 0.948 0.963 0.928 test 0.96 0.956 0.96 0.948 0.925 0.93 0.849 MASE 0.829 0.892 0.833 0.981 1.22 1.184 1.831 黃豆 train 0.977 0.96 0.953 0.959 0.959 0.87 0.844 test 0.954 0.946 0.907 0.932 0.929 0.71 0.748 MASE 0.442 0.491 0.711 0.582 0.604 1.306 1.284 原油 train 0.989 0.986 0.988 0.989 0.991 0.967 0.968 test 0.948 0.918 0.936 0.959 0.903 0.849 0.881 MASE 1.435 1.682 1.592 1.161 1.568 2.196 1.631 圖 41 客製化損失函數TCN 的Dilations 在黃金之選擇 圖 42 客製化損失函數TCN 的Dilations 在黃豆之選擇 圖 43 客製化損失函數TCN 的Dilations 在原油之選擇 表 17 客製化損失函數TCN 模型之運算結果（Dropout_rate） Dropout_rate 0.2 0.5 0.7 黃金 train 0.981 0.979 0.967 0.963 test 0.959 0.96 0.903 0.912 MASE 0.85 0.833 1.222 1.198 黃豆 train 0.982 0.953 0.778 0.179 test 0.95 0.907 0.525 -0.169 MASE 0.462 0.711 1.88 2.687 原油 train 0.99 0.988 0.983 0.99 test 0.913 0.936 0.98 0.936 MASE 1.765 1.592 0.781 1.38 圖 44 客製化損失函數TCN 的Dropout_rate 在黃金之選擇 圖 45 客製化損失函數TCN 的Dropout_rate 在黃豆之選擇 圖 46 客製化損失函數TCN 的Dropout_rate 在原油之選擇
