Haar-like 特徵的人臉偵測方法是不同形式的特徵如圖2.2 所示，1.為邊緣特徵的 四種、2.為線特徵八種、3.為中心包圍特徵兩種，將白色部分的影像像素值總和減去 黑色部分的影像像素值總和來計算其特徵，利用改變矩形特徵的大小和位置，即可在 影像中取出大量的特徵。 多特徵自動化表情辨識系統 圖2.2 Haar-like 矩形特徵 (資料來源：Viola, 2001) 在影像當中的感興趣區域 (Region of interest, ROI) 中，使用了Cascade 方法來對 多個階層的分類器進行判斷，每一個感興趣區域在所有的階層都通過之後，就被分被 為正確的結果；反之，在任一階層中被拒絕了就被淘汰。而在每一階層當中的分類器 中，對基本的分類器採用了Boosting 方法 (AdaBoost)，每個基本的分類器是至少2 元的決策樹分類器，他們的輸入即為所有前述的Haar-like 特徵。 圖2.3 點 (x,y) 為左上角灰階區域積分影像值 (資料來源：Viola, 2001) 積分影像利用矩形特徵可以非常迅速的計算圖像中間位置，輸入一個影像，將彩 色影像轉為灰階影像，藉由彩色影像的RGB 值得到，灰階值範圍從0 至255。 多特徵自動化表情辨識系統 如圖2.3 所示，積分影像點 (x, y) 位置的值為左上角所有灰色方塊範圍內的pixel 的灰階值的加總，積分值加總方程式如下： I (𝑥, 𝑦) = ∑𝑖 (𝑥′, 𝑦′) 𝑥′≤𝑥 𝑦′≤𝑦 (2.1) 如此定義，如果要得到一個輸入影像I 的積分影像時，僅需對原圖像逐點掃描一 次就可以計算出來。計算方式如下： I (𝑥, 𝑦) = 𝑖 (𝑥, 𝑦) + 𝐼 (𝑥−1, 𝑦) + 𝐼 (𝑥, 𝑦−1) −𝐼 (𝑥−1, 𝑦−1)          (2.2) 圖2.4 矩形和示意圖 (資料來源：Viola, 2001) 如圖2.4 所示，積分影像在p1 點的積分值表示區域A 的灰階值總和，記為𝐼(𝑝1)， 在p2 點的積分值為區域A+區域B，記為𝐼 (𝑝2)，也可以記成𝑖 (𝑝1) + 𝑖 (𝑝2)，在p3 點 的積分值為區域A+區域C，記為𝐼 (𝑝3)，也可以記成𝑖 (𝑝1) + 𝑖 (𝑝3)，在p4 點的值為區 域A+區域B+區域C+區域D，記為𝐼 (𝑝4)，也可以記成𝑖 (𝑝1) + 𝑖 (𝑝2) + 𝑖 (𝑝3) + 𝑖 (𝑝4)。 於是，由𝑝1，𝑝2，𝑝3，𝑝4 圍成的矩形區域D 的灰階值總和可以表示為： i (p4) = I (p4) −[I (p2) + I (p3)] + I (p1)                    (2.3) 多特徵自動化表情辨識系統 有了integral image 值的定義以後，對於一張影像得到一些feature，這些features 我們稱之為rectangle feature，任何影像可以僅用四個參考值計算即可取得，如圖2.5 所示，這些rectangle feature 大小不固定，但是白色的區塊一定和黑色區塊一樣大。這 些方塊會像filter 一樣，在一張影像上移動。而對於每一個feature 值的計算，就是將 白色區塊的integral 的值減掉灰色區塊integral 的值，在Viola 的系統中，每個rectangle feature 值的計算，最多只需要從積分影像中取9 個元素做加減運算。這是Viola 方法 速度非常快的原因。 圖2.5 四種矩形特徵，A 和B 為邊界特徵，C 為細線特徵，D 為對角線特徵 (資料來源：Viola, 2001)
